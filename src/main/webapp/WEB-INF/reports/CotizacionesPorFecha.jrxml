<?xml version="1.0" encoding="UTF-8"?>
<jasperReport
        xmlns="http://jasperreports.sourceforge.net/jasperreports"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
      http://jasperreports.sourceforge.net/jasperreports
      http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
        name="CotizacionesPorFechaMinimal"
        pageWidth="595"
        pageHeight="842"
        columnWidth="515"
        leftMargin="40"
        rightMargin="40"
        topMargin="50"
        bottomMargin="50">

    <!-- 1) Parámetros -->
    <parameter name="FechaInicio" class="java.sql.Date"/>
    <parameter name="FechaFin"    class="java.sql.Date"/>

    <!-- 2) Campos (FIELDS) -->
    <field name="id_cotizacion"    class="java.lang.Integer"/>
    <field name="cliente"          class="java.lang.String"/>
    <field name="fecha_creacion"   class="java.sql.Date"/>
    <field name="estado"           class="java.lang.String"/>
    <field name="total_proyectado" class="java.lang.Double"/>

    <!-- 3) Consulta SQL (QUERY) -->
    <queryString>
        <![CDATA[
        SELECT
          c.id_cotizacion AS id_cotizacion,
          cl.nombre       AS cliente,
          c.fecha_creacion AS fecha_creacion,
          c.estado        AS estado,
          SUM(a.horas_estimadas * e.costo_por_hora) AS total_proyectado
        FROM cotizacion c
        JOIN cliente cl    ON c.id_cliente   = cl.id_cliente
        JOIN asignacion a  ON a.id_cotizacion = c.id_cotizacion
        JOIN empleado e    ON a.id_empleado   = e.id_empleado
        WHERE c.fecha_creacion
          BETWEEN $P{FechaInicio} AND $P{FechaFin}
        GROUP BY c.id_cotizacion, cl.nombre, c.fecha_creacion, c.estado
      ]]>
    </queryString>

    <!-- 4) Banda de título sencilla -->
    <title>
        <band height="40">
            <staticText>
                <reportElement x="0" y="5" width="515" height="30"/>
                <textElement textAlignment="Center">
                    <font size="16" isBold="true"/>
                </textElement>
                <text><![CDATA[Reporte de Cotizaciones (Mínimo)]]></text>
            </staticText>
        </band>
    </title>

    <!-- 5) Encabezado simple de columnas -->
    <columnHeader>
        <band height="20">
            <staticText>
                <reportElement x="0" y="0" width="80" height="20"/>
                <textElement>
                    <font isBold="true"/>
                </textElement>
                <text><![CDATA[ID]]></text>
            </staticText>
            <staticText>
                <reportElement x="80" y="0" width="200" height="20"/>
                <textElement>
                    <font isBold="true"/>
                </textElement>
                <text><![CDATA[Cliente]]></text>
            </staticText>
        </band>
    </columnHeader>

    <!-- 6) Detalle muy sencillo (solo dos campos para probar) -->
    <detail>
        <band height="20">
            <textField>
                <reportElement x="0" y="0" width="80" height="20"/>
                <textFieldExpression><![CDATA[$F{id_cotizacion}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="80" y="0" width="200" height="20"/>
                <textFieldExpression><![CDATA[$F{cliente}]]></textFieldExpression>
            </textField>
        </band>
    </detail>

    <!-- 7) Pie de página sencillo (número de página) -->
    <pageFooter>
        <band height="20">
            <textField>
                <reportElement x="0" y="0" width="515" height="20"/>
                <textElement textAlignment="Right">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA["Página " + $V{PAGE_NUMBER}]]></textFieldExpression>
            </textField>
        </band>
    </pageFooter>

</jasperReport>
